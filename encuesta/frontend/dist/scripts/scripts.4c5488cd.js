"use strict";angular.module("colfatimaApp",["ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ui.router","ngSanitize","md.data.table","ngMaterial","chart.js","ngCsv"]).config(["$mdThemingProvider","$mdIconProvider","$stateProvider","$urlRouterProvider","ChartJsProvider",function(a,b,c,d,e){e.setOptions({animation:!1}),a.theme("default").primaryPalette("green").accentPalette("amber").backgroundPalette("grey").warnPalette("red"),b.defaultIconSet("images/mdi.677433a0.svg"),d.otherwise("/"),c.state("index",{url:"/",templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).state("index.encuesta",{url:"presentar/:encuesta/:area/:docente/:curso/:estudiante",templateUrl:"views/encuesta.html",controller:"EncuestaCtrl",controllerAs:"encuesta"}).state("admin",{url:"/admin",templateUrl:"views/admin.html",controller:"AdminCtrl",controllerAs:"admin"}).state("admin.list",{url:"/:model",templateUrl:"views/admin-list.html",controller:"AdminListCtrl",controllerAs:"adminlist"}).state("admin.list.form",{url:"/:id",templateUrl:"views/admin-form.html",controller:"AdminFormCtrl",controllerAs:"adminform"})}]),angular.module("colfatimaApp").controller("MainCtrl",["Model","$state","$mdToast","$rootScope",function(a,b,c,d){function e(){if(h.codigoEstudiante&&h.cursoEstudiante&&h.docente&&h.area){var a=h.cursos.filter(function(a){return a.id===h.cursoEstudiante})[0];a&&a.id&&h.codigoEstudiante>0&&h.codigoEstudiante<=a.cantidad?b.go("index.encuesta",{area:h.area,docente:h.docente,encuesta:h.encuesta.id,curso:h.cursoEstudiante,estudiante:h.codigoEstudiante}):a&&a.id&&g("Estudiante no encontrado")}else{var c=[],d="Por favor, verifica ";h.area||c.push("el area"),h.docente||c.push("el docente"),h.codigoEstudiante||c.push("el código"),h.cursoEstudiante||c.push("el curso"),g(d+c.join(", "))}}function f(){var a=h.cursos.filter(function(a){return a.id===h.cursoEstudiante})[0],b=[];if(a&&a.cantidad)for(var c=1;c<=a.cantidad;c++)b.push(c);return b}function g(a){c.show(c.simple().textContent(a).position("top right"))}var h=this,i=a.getNew("colegio"),j=a.getNew("curso"),k=a.getNew("docente"),l=a.getNew("area");a.getNew("estudiante");d.encuestaIniciada=!1,h.year=(new Date).getFullYear(),h.area=null,h.cursos=[],h.docente=null,h.colegio={},h.encuesta={},h.cursoEstudiante="",h.codigoEstudiante="",h.iniciarEncuesta=e,h.getCodigos=f,l.find().then(function(a){h.areas=a}),k.find().then(function(a){h.docentes=a}),i.find().then(function(a){h.colegio=a[0],h.encuesta=h.colegio.encuestas[0],j.find({where:{colegio:h.colegio},populate:"estudiantes"}).then(function(a){h.cursos=a})})}]),angular.module("colfatimaApp").controller("AdminCtrl",["$http","Model","$q","$mdToast",function(a,b,c,d){function e(){var a=r.encuesta.preguntas,b=[],c=0;for(c=0;c<a.length;c++){a[c].estadistica=a[c].estadistica||{},a[c].estadistica.total=a[c].estadistica.total||0,a[c].estadistica.areas=a[c].estadistica.areas||{},a[c].estadistica.docentes=a[c].estadistica.docentes||{},a[c].estadistica.respuestas=a[c].estadistica.respuestas||{},a[c].estadistica.estudiantes=a[c].estadistica.estudiantes||{};var d={},e={},f={},g={};a[c].respuestas=a[c].respuestas.filter(function(a){var c=b.indexOf(a.estudiante+a.pregunta)>-1;return b.push(a.estudiante+a.pregunta),c||(d[a.area]=d[a.area]||{},d[a.area].total=d[a.area].total||0,d[a.area][a.respuesta||a.recurso]=d[a.area][a.respuesta||a.recurso]||0,d[a.area][a.respuesta||a.recurso]++,d[a.area].total++,e[a.docente]=e[a.docente]||{},e[a.docente].total=e[a.docente].total||0,e[a.docente][a.respuesta||a.recurso]=e[a.docente][a.respuesta||a.recurso]||0,e[a.docente][a.respuesta||a.recurso]++,e[a.docente].total++,f[a.respuesta||a.recurso]=f[a.respuesta||a.recurso]||0,f.total=f.total||0,f[a.respuesta||a.recurso]++,f.total++,g[a.estudiante]=g[a.estudiante]||{},g[a.estudiante].total=g[a.estudiante].total||0,g[a.estudiante][a.respuesta||a.recurso]=g[a.estudiante][a.respuesta||a.recurso]||0,g[a.estudiante][a.respuesta||a.recurso]++,g[a.estudiante].total++),!c}),a[c].estadistica.total=a[c].respuestas.length,a[c].estadistica.areas=d,a[c].estadistica.docentes=e,a[c].estadistica.respuestas=f,a[c].estadistica.estudiantes=g}n()}function f(a){a?r.show=a:r.show="table"===r.show?"graph":"table"}function g(){k("grado")}function h(){k("curso")}function i(){r.docente={},k("area")}function j(){r.area={},k("docente")}function k(a){if(r[a])if(r[a].id){var b={};r.area&&r.area.id?b.area=r.area.id:r.docente&&r.docente.id&&(b.docente=r.docente.id)}else"Todos"===r[a].nombre&&(r[a]={});else r[a]={};n()}function l(a,b,c){var d=m(a),e=0;d&&d.total?(c&&(e=d.total),b&&(e=d[b.id])):(d=d||{},b&&b.id&&(d[b.id]=0),d.total=0);var f=d.total>0?(e/d.total*100).toFixed(2):0;return e=e||0,f=f||0,e+"("+f+"%)"}function m(a){var b=a.estadistica.respuestas||{};return r.area&&r.area.id?b=a.estadistica.areas[r.area.id]:r.docente&&r.docente.id&&(b=a.estadistica.docentes[r.docente.id]),b}function n(){var a={};r.graph.general.options={},r.graph.general.labels.length<1&&_.forEach(r.encuesta.preguntas,function(a,b){a.opciones&&a.opciones.length>0&&r.graph.general.labels.push(b+1+". "+_.truncate(a.enunciado))}),_.forEach(r.encuesta.preguntas,function(b,c){var d=m(b),e=[],f=[],g="Bar";r.graph.datasetOverride[b.id]=[],r.graph.type[b.id]=g,r.graph.labels[b.id]=f,r.graph.series[b.id]=[],r.graph.data[b.id]=[],r.graph.options[b.id]=r.graph.options[b.id]||{responsive:!1,legend:{display:!0,position:"bottom"},title:{display:!0,position:"top",text:b.enunciado}},b.opciones&&b.opciones.length>0?(r.graph.options[b.id].showTooltips=!1,r.graph.options[b.id].onAnimationComplete=function(){var a=this.datasets||this.segments;a[0]&&a[0].bars&&(a=a[0].bars),this.showTooltip(a,!0)},_.forEach(b.opciones,function(b){var c=d&&d[b.id]||0;e.push(c),a[b.id]=a[b.id]||[],a[b.id].push(c),f.push(_.truncate(b.enunciado))}),r.graph.general.series.length<1&&(r.graph.general.series=f)):(g="Pie",_.forEach(r.recursos,function(a){var b=d&&d[a.id]||0,c=d&&d.total&&d.total>0?Math.round(b/d.total*100):0;e.push(b),f.push(a.nombre+" ("+c+"%)")})),r.graph.series[b.id].length<1&&(r.graph.series[b.id].push(b.enunciado),r.graph.datasetOverride[b.id].push({label:b.enunciado,borderWidth:1,type:g}),r.graph.type[b.id]=g),r.graph.labels[b.id]=f,"Pie"!==r.graph.type[b.id]&&(e=[e]),r.graph.data[b.id]=e}),r.graph.general.data=_.values(a)}function o(){r.usr.login="aura_bonett@hotmail.com"===r.usr.email&&"hijos8793"===r.usr.clave;var a=d.simple().textContent(r.usr.login?"Binevenido":"Usuario o clave errónea").position("top right");d.show(a)}function p(a){var b=["pregunta"];return a&&a.opciones&&a.opciones.length>0?(_.forEach(a.opciones,function(a){b.push(a.enunciado),b.push(a.enunciado+"%")}),b.push("total")):b=p(r.encuesta.preguntas[0]),b}function q(a){var b=[],c=null,d={};if(a)a.opciones&&a.opciones.length>0&&(c=m(a),d.pregunta=a.enunciado,_.forEach(a.opciones,function(a){d[a.enunciado]=c&&c[a.id]||0,c.total>0?d[a.enunciado+"%"]=(d[a.enunciado]/c.total*100).toFixed(2)+"%":d[a.enunciado+"%"]="0%"}),d.total=c.total,b.push(d));else{var e=0;_.forEach(r.encuesta.preguntas,function(a){a.opciones&&a.opciones.length>0&&(d[a.enunciado]=q(a)[0],e+=d[a.enunciado].total)}),b=_.values(d)}return b}var r=this,s=b.getNew("area"),t=(b.getNew("grado"),b.getNew("curso")),u=b.getNew("colegio"),v=b.getNew("docente"),w=b.getNew("recurso"),x=b.getNew("encuesta"),y=b.getNew("pregunta"),z=(b.getNew("respuesta"),b.getNew("respuestaestudiante"),{nombre:"Todos"});r.estadisticas={},r.models={},r.colegio={},r.grados=[z],r.grado={},r.cursos=[z],r.curso={},r.areas=[z],r.area={},r.docentes=[z],r.recursos=[],r.docente={},r.encuesta={},r.respuestasestudiantes=[],r.respuestas={areas:{},docentes:{}},r.show="graph",r.tiposGraph=["Line","Bar","HorizontalBar","Radar","Pie","PolarArea","Doughnut","Bubble"],r.graph={type:{},data:{},series:{},labels:{},options:{},datasetOverride:{},general:{type:"Bar",data:[],series:[],labels:[],options:{},datasetOverride:{}}},r.usr={},r.loadSelectedDocente=j,r.loadSelectedGrado=g,r.loadSelectedCurso=h,r.loadSelectedArea=i,r.getEstadistica=m,r.getHeaderTable=p,r.estadistica=l,r.toggleShow=f,r.getTable=q,r.entrar=o,s.find().then(function(a){r.areas=r.areas.concat(a),v.find().then(function(a){r.docentes=r.docentes.concat(a),w.find().then(function(a){r.recursos=a,u.find().then(function(a){r.colegio=a[0],r.grados=r.grados.concat(r.colegio.grados),x.findOne(r.colegio.encuestas[0].id).then(function(a){y.find({where:{id:a.preguntas.map(function(a){return a.id})}}).then(function(b){a.preguntas=b,r.encuesta=a,e()})}),t.find({where:{colegio:r.colegio}}).then(function(a){r.cursos=r.cursos.concat(a)})})})})})}]),angular.module("colfatimaApp").controller("AdminFormCtrl",["$stateParams","Model","$q",function(a,b,c){function d(){return n.then(function(a){return a.attrs().then(function(b){return k.attrs=b,a})})}function e(a){console.log(k.searchText[a])}function f(a){console.log(a)}function g(a,c){function d(a,c,d){var e=b.getNew("estudiante",{});e.nombre="Estudiante "+d+" Curso "+a.nombre,e.codigo=d,e.curso=a.id,e.$create().then(function(a){console.log(a.nombre+" creado!!")})}console.log(a);var e=null;e=a.id?a.$update().then(function(a){return console.log(a),a}):a.$create().then(function(a){return k.list[c]=b.getNew(l,{}),k.searchText[c]="",a}),e.then(function(a){if(console.log(l+" -> ",a),"curso"===l)for(var c=1;c<=a.cantidad;c++)d(a,b.getNew("estudiante"),c)})}function h(a){return a}function i(a,b){return j(a,k.searchTextChip,b)}function j(a,e,f){return e=e||k.searchText,e=e[f],c(function(c,f){d().then(function(){if(e&&e.length){if(a["enum"])return c(a["enum"].filter(function(a){return a.indexOf(e)>-1}));var d=b.getNew(a.model||a.collection);return d.attrs().then(function(a){var b={};return b.nombre={contains:e},b},f).then(function(a){return d.find({where:a}).then(function(a){return console.log(a),angular.isArray(a)?c(a.filter(function(a){var b=-1;return a.nombre?b=a.nombre.indexOf(e):a.titulo?b=a.titulo.indexOf(e):a.enunciado&&(b=a.enunciado.indexOf(e)),b>-1})):void c([])},f)})}return a["enum"]?c(a["enum"]):a.model?b.getNew(a.model).find().then(function(a){return c(a)},f):void 0})})}var k=this,l=a.model,m=a.id,n=b.getAttrsModel(l);k.save=g,k.attrs={},k.list=[],k.searchText={},k.selectedItem=[],k.querySearch=j,k.searchTextChange=e,k.selectedItemChange=f,k.searchTextChip={},k.selectedItemChip=[],k.transformChip=h,k.querySearchChip=i,k.selectedItemChange=f,"add"===m?d().then(function(){k.list.push(b.getNew(l,{}))}):angular.isArray(JSON.parse(m))&&(m=JSON.parse(m),d().then(function(a){m.filter(function(b){a.findOne(b).then(function(a){k.list.push(a)})})}))}]),angular.module("colfatimaApp").controller("AdminListCtrl",["$stateParams","Model","$q",function(a,b,c){function d(){i.showlist=!i.showlist}function e(){return k.then(function(a){return a.attrs().then(function(b){return i.attrs=b,a})})}function f(){return i.selected.map(function(a){return a.id})}function g(){return e().then(function(a){a.find({sort:"nombre ASC"}).then(function(a){return i.list=a,a})})}function h(){e().then(function(a){for(var b=0;b<i.selected.length;b++)a.destroy(i.selected[b].id).then(function(a){i.selected.splice(b,1),console.log(a)})})}var i=this,j=a.model,k=b.getAttrsModel(j);i.list=[],i.selected=[],i.getList=g,i.promise=g(),i.attrs={},i.showlist=!0,i.toggleShowList=d,i.getSelectedIds=f,i.destroy=h,i.resources={list:[{title:"",route:"",icon:""}]}}]),angular.module("colfatimaApp").service("Model",["$http","$q","$location",function(a,b,c){function d(a,b){return new g(a,b)}function e(c){return b(function(b,c){a.get(i+"admin/attributes/lista").then(function(a){h={},a=a.data,angular.forEach(a,function(a,b){h[b]=new g(b)}),b(h)},c)})}function f(a,c){return b(function(b,d){e(c).then(function(){b(h[a])},d)})}function g(b,c){function d(){return e()}function e(){return a.get(B+"/"+b).then(x,y)}function f(){return h(C.toJSON())}function h(c){return a.post(i+b+"/create",c).then(x,y)}function j(){return k(C.id,C.toJSON())}function k(c,d){return a.put(i+b+"/update/"+c,d).then(x,y)}function l(){return m(C.id)}function m(c){return c=c||C.id,a["delete"](i+b+"/"+c).then(x,y)}function n(c){return c=c||C.id,a.get(i+b+"/"+c).then(x,y)}function o(a){return p(a)}function p(c){return c=c||{},a.get(i+b,c).then(x,y)}function q(a){return r(C.id,a)}function r(c,d){return c=c||C.id,a.get(i+b+"/"+c+"/"+d).then(x,y)}function s(a,b){return t(C.id,a,b)}function t(c,d,e){return c=c||C.id,a.post(i+b+"/"+c+"/"+d+"/"+e).then(x,y)}function u(a,b){return v(C.id,a,b)}function v(c,d,e){return c=c||C.id,a["delete"](i+b+"/"+c+"/"+d+"/"+e).then(x,y)}function w(){var a=this,b=angular.merge({},a);return angular.forEach(a,function(a,c){c.indexOf("$")>-1&&delete b[c]}),b}function x(a){var b=a.data;return angular.isArray(b)?b=b.map(function(a,b){return a=z(a)}):angular.isObject(b)&&angular.isString(b.id)&&(b=z(b)),a.data=b,200===a.status||201===a.status?a.data:a}function y(a){return a}function z(a){return a=new g(b,a),a.id&&delete a.$create,a}c=c||null;var A=i+"admin",B=A+"/attributes",C={$modelname:b,$destroy:l,$create:f,$update:j,$find:o,$add:s,$remove:u,$attrs:d,$populate:q,toJSON:w};return c?C=angular.merge({},C,c):{modelname:b,findOne:n,destroy:m,create:h,update:k,find:p,add:t,remove:v,attrs:e,populate:r}}var h=null,i="http://";return i+=c.host().indexOf("localhost")<0?"104.236.247.198/":"localhost:1337/",{getNew:d,getAttrs:e,getAttrsModel:f}}]),angular.module("colfatimaApp").controller("EncuestaCtrl",["Model","$stateParams","$rootScope","$mdToast","$timeout",function(a,b,c,d,e){function f(a){return r.findOne(o.preguntas[a].id).then(function(b){o.preguntas[a]=b})}function g(){return v.findOne(o.estudiante.id).then(function(a){o.estudiante=a})}function h(){return s.find().then(function(a){o.recursos=a})}function i(a){var b=o.otrorecurso;b=b.indexOf(",")>-1?b.split(",").map(function(a){return{nombre:a}}):[{nombre:b}],s.create(b).then(function(b){h();for(var c=0;c<b.length;c++)j(a,b[c])})}function j(a,b){o.disabled=!0;var c=null,d=null;a.hasRecursos?(c=l(a,b),d=c?B.findOne(c.id).then(function(a){return a.$destroy().then(function(){return"Respuesta actualizada"})}):B.create({recurso:b.id,pregunta:a.id,encuesta:o.encuesta.id,estudiante:o.estudiante.id,docente:o.docente.id,area:o.area.id}).then(function(a){return"Respuesta guardada"})):(c=k(a,b),c?(c.respuesta=b.id,d=B.findOne(c.id).then(function(a){return a.respuesta=b.id,a.$update().then(function(a){return"Respuesta actualizada"})})):d=B.create({respuesta:b.id,pregunta:a.id,encuesta:o.encuesta.id,estudiante:o.estudiante.id,docente:o.docente.id,area:o.area.id}).then(function(a){return"Respuesta guardada"})),d.then(function(a){return g().then(function(){m(a),o.disabled=!1})},function(a){console.error(a),o.disabled=!1,m("No se guardó tu respuesta, intenta en unos segundos.")})}function k(a,b){var c=o.estudiante.respuestas||[];return c.filter(function(b){return b.area===o.area.id&&b.docente===o.docente.id&&b.estudiante===o.estudiante.id&&b.encuesta===o.encuesta.id&&b.pregunta===a.id})[0]}function l(a,b){var c=o.estudiante.respuestas||[];return c.filter(function(c){var d=c.respuesta===b.id;return a.hasRecursos&&(d=c.recurso===b.id),c.area===o.area.id&&c.docente===o.docente.id&&c.estudiante===o.estudiante.id&&c.encuesta===o.encuesta.id&&c.pregunta===a.id&&d})[0]}function m(a){function b(){D&&e.cancel(),D=e(function(){C=""},1500)}a!==C?(d.show(d.simple().textContent(a).position("top right").hideDelay(3e3)),b()):b(),C=a}function n(a,b,c){return o.otrorecurso.length>0&&a.nombre?_.kebabCase(_.deburr(a.nombre)).indexOf(_.kebabCase(_.deburr(o.otrorecurso)))>-1:!0}var o=this,p=a.getNew("encuesta"),q=a.getNew("curso"),r=a.getNew("pregunta"),s=a.getNew("recurso"),t=a.getNew("area"),u=a.getNew("docente"),v=a.getNew("estudiante"),w=b.encuesta,x=b.curso,y=b.estudiante,z=b.area,A=b.docente,B=a.getNew("respuestaestudiante");o.area={},o.curso={},o.docente={},o.encuesta={},o.estudiante={},o.preguntas=[],o.recursos=[],o.otrorecurso="",o.rtaSelected=l,o.createRecurso=i,o.hasPresented=k,o.saveRespuesta=j,o.filterRecurso=n,c.encuestaIniciada=!0,t.findOne(z).then(function(a){o.area=a}),u.findOne(A).then(function(a){o.docente=a}),p.findOne(w).then(function(a){o.encuesta=a,o.preguntas=a.preguntas;for(var b=0;b<o.preguntas.length;b++)f(b);q.findOne(x).then(function(a){o.curso=a,o.estudiante=a.estudiantes.filter(function(a){return a.codigo===y})[0],g()})}),h();var C="",D=null}]),angular.module("colfatimaApp").run(["$templateCache",function(a){a.put("views/admin-form.html",'<div layout-fill> <form ng-repeat="item in adminform.list" ng-submit="adminform.save(item, $index)" ng-init="indexItem = $index"> <md-toolbar class="md-accent md-hue-1"> <div class="md-toolbar-tools"> <md-button type="submit"> Guardar </md-button> </div> </md-toolbar> <md-content layout="column" flex> <div ng-repeat="(name, attr) in adminform.attrs" layout="row" flex="100" flex-gt-xs="50"> <md-input-container ng-if="!attr.enum && !attr.model && !attr.collection" flex> <label>{{ ::name }}</label> <input ng-if="attr.type === \'string\' || attr.type === \'int\' || attr.type === \'integer\' || attr.type === \'float\' || attr.type === \'number\'" type="text" ng-model="item[name]" md-autofocus> <!--<input\n            ng-if="attr.type === \'string\' || attr.type === \'int\' || attr.type === \'integer\' || attr.type === \'float\' || attr.type === \'number\'"\n            type="{{ ::(attr.type === \'string\'?\'text\':\'number\') }}"\n            ng-model="item[name]"\n            md-autofocus="indexItem == 0 || indexItem == 1"\n          />--> <textarea ng-if="attr.type === \'text\'" ng-model="item[name]" md-autofocus></textarea> </md-input-container> <div ng-if="attr.enum || attr.model" flex> <md-autocomplete md-selected-item="item[name]" md-search-text-change="adminform.searchTextChange()" md-search-text="adminform.searchText[indexItem]" md-selected-item-change="adminform.selectedItemChange(item)" md-items="subitem in adminform.querySearch(attr, null, indexItem )" md-item-text="subitem.nombre || subitem.titulo || subitem.enunciado  || subitem" md-min-length="0" placeholder="{{ ::name }}"> <md-item-template> <span md-highlight-text="adminform.searchText[indexItem]" md-highlight-flags="^i"> {{ subitem.nombre || subitem.titulo || subitem.enunciado || subitem }} </span> </md-item-template> <md-not-found> La búsqueda "{{ adminform.searchText[indexItem] }}" no tiene resultados. <md-button ng-click="adminform.addNew( adminform.searchText[indexItem], $index)"> Agregarlo </md-button> </md-not-found> </md-autocomplete> </div> <div ng-if="attr.collection" flex ng-init="item[name] = item[name] || []"> <md-chips ng-model="item[name]" md-autocomplete-snap md-transform-chip="adminform.transformChip($chip)" md-require-match="true"> <md-autocomplete md-selected-item="adminform.selectedItemChip" md-search-text="adminform.searchTextChip[indexItem]" md-items="subitem in adminform.querySearchChip(attr, indexItem)" md-item-text="subitem.nombre || subitem.titulo || subitem.enunciado  || subitem" placeholder="{{ ::name }}"> <span md-highlight-text="adminform.searchTextChip[indexItem]"> {{ subitem.nombre || subitem.titulo || subitem.enunciado || subitem }} </span> </md-autocomplete> <md-chip-template> <span> {{ $chip.nombre || $chip.titulo || $chip.enunciado || $chip }} </span> </md-chip-template> </md-chips> </div> </div> </md-content> </form> </div>'),a.put("views/admin-list.html",'<!--<table>\n  <thead>\n    <tr>\n      <td ng-repeat="(name, attr) in adminlist.attrs">\n        {{ name }}\n      </td>\n      <td>\n        acciones\n      </td>\n    </tr>\n  </thead>\n  <tbody>\n    <tr ng-repeat="item in adminlist.list">\n      <td ng-repeat="(name, attr) in adminlist.attrs">\n        {{ item[name] }}\n      </td>\n    </tr>\n  </tbody>\n</table>--> <md-toolbar class="md-hue-2"> <div class="md-toolbar-tools" ng-if="adminlist.selected.length > 0"> <span flex></span> <!--<md-button ui-sref="admin.list.form(\'id\': \'{{ adminlist.getSelectedIds() }}\')">--> <md-button ui-sref="admin.list.form( { \'id\': \'{{ adminlist.getSelectedIds() }}\' } )"> Editar </md-button> <md-button ng-click="adminlist.destroy()"> Borrar </md-button> </div> <div class="md-toolbar-tools" ng-if="adminlist.selected.length <= 0"> <md-button ui-sref="admin.list.form({\'id\': \'add\'})"> Agregar </md-button> <md-button ng-click="adminlist.toggleShowList()"> {{ adminlist.showlist?\'ocultar\':\'mostrar\'}} tabla </md-button> <md-menu> <md-button aria-label="Open menu" class="md-icon-button" ng-click="adminlist.openMenu($mdMenu, $event)"> <md-icon md-menu-origin md-svg-icon="menu"></md-icon> </md-button> <md-menu-content width="4"> <md-menu-item ng-repeat="resource in adminlist.resources.list"> <md-button ui-sref="admin.list({model: \'{{ ::resource.route }}\'})"> <md-icon md-svg-icon="{{ ::resource.icon }}" md-menu-align-target></md-icon> {{ ::resource.title }} </md-button> </md-menu-item> </md-menu-content> </md-menu> </div> </md-toolbar> <md-content layout="column"> <md-table-container flex ng-show="adminlist.showlist"> <table md-table md-row-select multiple ng-model="adminlist.selected" md-progress="adminlist.promise"> <thead md-head md-order="adminlist.query.order" md-on-reorder="adminlist.getList"> <tr md-row> <th md-column md-order-by="{{ ::key }}" ng-repeat="(name, attr) in adminlist.attrs"> <span> {{ ::name }} </span> </th> </tr> </thead> <tbody md-body> <tr ng-repeat="item in adminlist.list" md-row md-select="item" md-select-id="id" md-auto-select> <td md-cell ng-repeat="(name, attr) in adminlist.attrs"> {{ item[name] }} </td> </tr> </tbody> </table> </md-table-container> <!--\n  <md-table-pagination\n    md-limit="query.limit"\n    md-limit-options="[10, 15, 25, 40]"\n    md-page="query.page"\n    md-total="{{ count }}"\n    md-on-paginate="reloadList"\n    md-page-select\n    md-label="{{ ::labelpagination }}"\n  ></md-table-pagination>--> <div ui-view></div> </md-content>'),a.put("views/admin.html",'<div class="login" layout-fill layout="column" ng-hide="admin.usr.login" layout-align="center center"> <div layout="row" layout-align="center center"> <form ng-submit="admin.entrar()"> <md-input-container> <label>Email</label> <input ng-model="admin.usr.email"> </md-input-container> <md-input-container> <label>Clave</label> <input type="password" ng-model="admin.usr.clave"> </md-input-container> <md-button type="submit"> Entrar </md-button> </form> </div> </div> <div flex layout="column" ng-if="admin.usr.login"> <!--<md-toolbar>\n    <md-content class="md-toolbar-tools">\n      <div layout="column">\n        <md-button\n          ui-sref="admin"\n        >\n          Estadísticas\n        </md-button>\n      </div>\n      <div layout="column" ng-repeat="model in admin.models">\n        <md-button\n          ui-sref="admin.list({\'model\': model.modelname})"\n        >\n          {{ ::model.modelname }}\n        </md-button>\n      </div>\n    </md-content>\n  </md-toolbar>--> <md-content flex ui-view layout="column"> <md-toolbar class="md-accent md-hue-1"> <div layout-align="center center" class="md-tooltip-tools" layout="row"> <div layout="column" flex> <md-button class="md-primary md-hue-2" ng-class="{\'md-raised\':admin.show === \'table\'}" ng-disabled="admin.show === \'table\'" ng-click="admin.toggleShow(\'table\')"> Tabla </md-button> </div> <div layout="column" flex> <md-button class="md-primary md-hue-2" ng-class="{\'md-raised\':admin.show === \'graph\'}" ng-disabled="admin.show === \'graph\'" ng-click="admin.toggleShow(\'graph\')"> Gráfico por Pregunta </md-button> </div> <div layout="column" flex> <md-button class="md-primary md-hue-2" ng-class="{\'md-raised\':admin.show === \'graph-general\'}" ng-disabled="admin.show === \'graph-general\'" ng-click="admin.toggleShow(\'graph-general\')"> Gráfico General </md-button> </div> <div layout="column"> <md-input-container layout="row"> <label>Área</label> <md-select flex ng-model="admin.area" class="md-primary md-hue-2" md-on-close="admin.loadSelectedArea()"> <md-option ng-repeat="area in admin.areas" ng-value="area"> {{ ::area.nombre }} </md-option> </md-select> </md-input-container> </div> <div layout="column"> <md-input-container layout="row"> <label>Docente</label> <md-select flex ng-model="admin.docente" class="md-primary md-hue-2" md-on-close="admin.loadSelectedDocente()"> <md-option ng-repeat="docente in admin.docentes" ng-value="docente"> {{ ::docente.nombre }} </md-option> </md-select> </md-input-container> </div> <div layout="column"> <md-button field-separator=";" csv-header="admin.getHeaderTable()" ng-csv="admin.getTable()" filename="Estadísticas-{{ admin.docente?admin.docente.nombre:admin.area?admin.area.nombre:\'General\' }}.csv"> Descargar Estadísticas </md-button> </div> </div> <div layout="column" ng-if="admin.show === \'graph-general\'"> <md-input-container layout="row"> <label>Tipo Gráfico</label> <md-select flex ng-model="admin.graph.general.type" class="md-primary md-hue-2"> <md-option ng-repeat="tipograph in admin.tiposGraph" ng-value="tipograph"> {{ ::tipograph }} </md-option> </md-select> </md-input-container> </div> </md-toolbar> <md-content flex ng-if="admin.show === \'graph-general\'" class="content-canvas"> <canvas width="800" height="400" class="chart-base" id="graph-general" chart-legend="true" chart-type="admin.graph.general.type" chart-data="admin.graph.general.data" chart-labels="admin.graph.general.labels" chart-series="admin.graph.general.series" chart-options="admin.graph.general.options" chart-dataset-override="admin.graph.general.datasetOverride"></canvas> </md-content> <md-content flex ng-if="admin.show === \'graph\'" class="content-canvas"> <div ng-repeat="preg in admin.encuesta.preguntas"> <md-toolbar class="md-primary md-hue-2"> <div layout-align="center center" class="md-toobar-tools" layout="row" flex> <span flex> {{ ::(($index + 1) + \'. \' + admin.graph.options[preg.id].title.text) }} </span> <md-button field-separator=";" csv-header="admin.getHeaderTable(preg)" ng-csv="admin.getTable(preg)" filename="{{ ::(($index + 1) + \'-\' + admin.graph.options[preg.id].title.text) }}.csv"> Descargar Tabla </md-button> <md-input-container layout="row"> <label>Tipo Gráfico</label> <md-select flex ng-model="admin.graph.type[preg.id]" class="md-primary md-hue-2"> <md-option ng-repeat="tipograph in admin.tiposGraph" ng-value="tipograph"> {{ ::tipograph }} </md-option> </md-select> </md-input-container> </div> </md-toolbar> <md-content> <canvas width="800" height="400" class="chart-base" id="graph-base-{{ ::preg.id}}" chart-legend="true" chart-type="admin.graph.type[preg.id]" chart-data="admin.graph.data[preg.id]" chart-labels="admin.graph.labels[preg.id]" chart-series="admin.graph.series[preg.id]" chart-options="admin.graph.options[preg.id]" chart-dataset-override="admin.graph.datasetOverride[preg.id]"></canvas> </md-content> </div> </md-content> <md-content flex ng-show="admin.show === \'table\'"> <md-toolbar class="md-accent md-hue-1"> <div class="md-toobar-tools" layout="row" layout-align="center end"> <div flex="40" flex-gt-sm="60" layout-align="center center" class="md-headline"> <div layout-margin layout-padding ng-if="(!admin.grado || !admin.grado.id) && (!admin.curso || !admin.curso.id) && (!admin.area || !admin.area.id) && (!admin.docente || !admin.docente.id)"> General </div> <div layout-margin layout-padding ng-if="(admin.grado && admin.grado.id) || (admin.curso && admin.curso.id) || (admin.area && admin.area.id) || (admin.docente && admin.docente.id)"> <span ng-if="admin.grado && admin.grado.id"> {{ admin.grado.codigo }}/ </span> <span ng-if="admin.curso && admin.curso.id"> {{ admin.curso.codigo }}/ </span> <span ng-if="admin.area && admin.area.id"> {{ admin.area.nombre }}/ </span> <span ng-if="admin.docente && admin.docente.id"> {{ admin.docente.nombre }} </span> </div> </div> <div flex style="text-align: center" layout-align="center center" layout="column" ng-repeat="opt in admin.encuesta.preguntas[0].opciones"> <span aria-label="opt.enunciado"> {{ ::opt.enunciado }} </span> </div> <div flex style="text-align: center" layout-align="center center" layout="column"> <span aria-label="total"> Total </span> </div> </div> </md-toolbar> <md-content layout="column" flex> <div layout="column" style="padding: 4px 15px" ng-repeat="pregunta in admin.encuesta.preguntas" class="md-whiteframe-1dp"> <div ng-if="!pregunta.hasRecursos" layout="row"> <p flex="40" flex-gt-sm="60"> {{ ::(($index + 1) + \'. \' + pregunta.enunciado) }} </p> <div flex layout="row" layout="wrap" layout-align="center center" ng-if="!pregunta.hasRecursos" ng-repeat="opt in pregunta.opciones"> {{ admin.estadistica(pregunta, opt) }} </div> <div flex layout="row" layout="wrap" layout-align="center center"> {{ admin.estadistica(pregunta, null, true) }} </div> </div> <p ng-if="pregunta.hasRecursos"> {{ ::(($index + 1) + \'. \' + pregunta.enunciado) }} </p> <div ng-if="pregunta.hasRecursos"> <div layout="row" ng-repeat="recurso in admin.recursos"> <span flex> {{ ::recurso.nombre }} </span> <span> {{ admin.estadistica(pregunta, recurso) }} <md-tooltip> {{ ::recurso.nombre }} </md-tooltip> </span> </div> </div> </div> </md-content> </md-content> </md-content> </div>'),a.put("views/encuesta.html",'<md-toolbar class="md-accent md-hue-1"> <div flex layout="row" class="md-toobar-tools" layout-align="center center"> <div flex="40" flex-gt-sm="60" layout-align="center center" class="md-headline"> <span layout-margin layout-padding> {{ encuesta.area.nombre }} - {{ encuesta.docente.nombre }} </span> </div> <div flex style="text-align: center" layout-align="center center" layout="column" ng-repeat="opt in encuesta.preguntas[0].opciones"> <span aria-label="opt.enunciado"> {{ ::opt.enunciado }} </span> </div> </div> </md-toolbar> <md-content layout="column"> <div layout="column" style="padding: 4px 15px" ng-repeat="pregunta in encuesta.preguntas" class="md-whiteframe-1dp"> <div ng-if="!pregunta.hasRecursos" layout="row"> <p flex="40" flex-gt-sm="60"> {{ ::(($index + 1) + \'. \' + pregunta.enunciado) }} </p> <div flex layout="column" layout-align="center center" ng-if="!pregunta.hasRecursos" ng-repeat="opt in pregunta.opciones"> <md-button ng-disabled="encuesta.disabled" class="md-raised" ng-class="{\'md-primary\': encuesta.rtaSelected(pregunta, opt)}" aria-label="{{ ::opt.enunciado }}" ng-click="encuesta.saveRespuesta(pregunta, opt)"></md-button> </div> </div> <p ng-if="pregunta.hasRecursos"> {{ ::(($index + 1) + \'. \' + pregunta.enunciado) }} </p> <div ng-if="pregunta.hasRecursos"> <md-button class="md-raised" ng-disabled="encuesta.disabled" ng-class="{\'md-primary\': encuesta.rtaSelected(pregunta, recurso)}" aria-label="{{ recurso.nombre || \'recurso\' }}" ng-click="encuesta.saveRespuesta(pregunta, recurso)" ng-repeat="recurso in encuesta.recursos | filter:encuesta.filterRecurso"> {{ recurso.nombre }} </md-button> <form ng-submit="encuesta.createRecurso(pregunta)" layout="row"> <md-input-container ng-if="pregunta.hasRecursos" flex> <label>Otros, Cuales</label> <input flex ng-model="encuesta.otrorecurso"> </md-input-container> <md-button class="md-primary" ui-sref="index" layout="column" layout-align="center center"> Agregar </md-button> </form> </div> </div> <md-button class="md-warn md-raised" ui-sref="index" layout="column"> Terminar </md-button> </md-content>'),a.put("views/main.html",'<md-toolbar class="md-hue-2"> <div class="md-toolbar-tools" layout-align="center center"> {{ ::main.colegio.nombre }} - {{ main.year }} </div> </md-toolbar> <md-toolbar class="md-hue-1 md-accent"> <div class="md-toolbar-tools" layout-align="center center"> {{ ::main.encuesta.titulo }} </div> </md-toolbar> <md-content flex layout="column"> <div> <p layout-padding layout-align="center center" layout="row"> <span>¡ Tu Opinión Cuenta !</span> </p> <p layout-margin layout-align="center center" layout="row"> <span>{{ ::main.encuesta.ayuda }}</span> </p> </div> <form ng-if="!encuestaIniciada" ng-submit="main.iniciarEncuesta()" class="md-primary md-hue-2" layout="row" layout-margin layout-align="center center"> <md-input-container> <label>Curso</label> <md-select ng-model="main.cursoEstudiante"> <md-option ng-repeat="curso in main.cursos" value="{{curso.id}}"> {{curso.codigo}} </md-option> </md-select> </md-input-container> <md-input-container> <label>Código</label> <md-select ng-model="main.codigoEstudiante" md-disabled="main.getCodigos().length < 1"> <md-option ng-repeat="codigo in main.getCodigos()" value="{{codigo}}"> {{codigo}} </md-option> </md-select> </md-input-container> <md-input-container> <label>Área</label> <md-select ng-model="main.area"> <md-option ng-repeat="area in main.areas | orderBy: \'nombre\'" value="{{ area.id }}"> {{ area.nombre }} </md-option> </md-select> </md-input-container> <md-input-container> <label>Docente</label> <md-select ng-model="main.docente"> <md-option ng-repeat="docente in main.docentes | orderBy: \'nombre\'" value="{{ docente.id }}"> {{ docente.nombre }} </md-option> </md-select> </md-input-container> <md-button class="md-raised md-primary md-hue-2" type="submit">Sig.</md-button> </form> <div ui-view style="margin:16px"></div> </md-content>');
}]);